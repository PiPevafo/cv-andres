---
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import Header from '../../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';
import { getCollection } from 'astro:content';

const projects = await getCollection('projects');
const projectsByYear = projects.reduce((acc, project) => {
	const year = project.data.year;
	if (!acc[year]) {
		acc[year] = [];
	}
	acc[year].push(project);
	return acc;
}, {});

const title = `Projects - ${SITE_TITLE}`;
---

<!doctype html>
<html lang='en'>
	<head>
		<BaseHead title={title} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<Header />
		<main>
			<h1>Projects</h1>
			<p>
				I find that projects, while not constituting original research,
				are a fun way to familiarize myself with different fields and
				their contemporary and historical methods. Below you can find
				descriptions of a variety of projects I have completed either
				independently, in preface to research, or as a substantial
				project in a course.
			</p>

			<section>
				{
					Object.keys(projectsByYear)
						.sort()
						.reverse()
						.map((year) => (
							<div class='year-group' key={year}>
								<h2>{year}</h2>
								<ul>
									{projectsByYear[year].map((project) => (
										<li key={project.data.slug}>
											<button class='project-toggle' onclick={`toggleProject('${project.data.slug}')`}>
												<h3>{project.data.title}</h3>
											</button>


											<div
												id={project.data.slug}
												class='project-content'
												style='display:none;'
											>
												<article
													class='prose'
													set:html={
														project.rendered?.html
													}
												/>
											</div>
										</li>
									))}
								</ul>
							</div>
						))
				}
			</section>
		</main>
		<Footer />
	</body>
	
	<script>
		window.toggleProject = function (slug) {
			const content = document.getElementById(slug);
			content.style.display =
				content.style.display === 'none' || content.style.display === ''
					? 'block'
					: 'none';
		};
	</script>
</html>

<style>
	.year-group {
		margin-bottom: 1rem;
	}
	.year-group h2 {
		border-bottom: 1px solid var(--gray);
		padding-bottom: 0.3rem;
		font-size: 1em;
	}
	.year-group ul {
		margin: 0;
	}
	.year-group li {
		margin: 0;
		padding: 0;
	}

	.project-toggle {
		background: none;
		border: none;
		text-align: left;
		cursor: pointer;
	}
	.project-toggle h3 {
		margin: 0;
		padding: 0;
		font-size: 1.1rem;
	}
	.project-toggle:hover h3 {
		text-decoration: underline;
	}

	.project-content {
		margin-top: 0.5rem;
		margin-bottom: 1.5rem;
		padding-left: 1rem;
	}
	.project-toggle:focus {
		outline: none;
	}
</style>
